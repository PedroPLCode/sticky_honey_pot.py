import re
from app.utils.exception_handler import exception_handler
from app.config import SQL_ATTACK_PATTERNS


@exception_handler()
def detect_exploit(data: str) -> list[str] | None:
    """
    Detects potential SQL injection exploits in the provided input data.

    Args:
        data (str): The input string to be analyzed for SQL injection patterns.

    Returns:
        list[str] or None: A list of detected threat names if any patterns match; otherwise, None.
    """
    data = data.lower()
    matched_threats: list[str] = []

    for pattern, threat_name in SQL_ATTACK_PATTERNS:
        if re.search(pattern, data):
            matched_threats.append(threat_name)

    return list(set(matched_threats)) if matched_threats else None
